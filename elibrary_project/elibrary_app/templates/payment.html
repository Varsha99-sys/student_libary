{% extends 'base.html' %}
{% block title %}Library | Payment{% endblock %}
{% block body %}
<div class="container">
    <div class="row">
        <h3>Total Amount: â‚¹{{ amount }}</h3>

        {% if error %}
            <mark><h1>{{ error }}</h1></mark>
        {% endif %}

        <!-- Display Book Information -->
        <h4>Book Title: {{ book.title }}</h4>
        <p>Author: {{ book.author_name }}</p>
        <p>Subject: {{ book.subject }}</p>
        <img src="{{ book.images.url }}" alt="{{ book.title }}" style="width: 200px;"/>

        <!-- Button to initiate Razorpay payment -->
        <button id="rzp-button1">Pay with Razorpay</button>

        <!-- Razorpay Checkout Script -->
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

        <script>
            var options = {
                "key": "rzp_test_wH0ggQnd7iT3nB",  // Replace with your Razorpay Key ID
                "amount": "{{ data.amount }}",  // Amount in paise (100 paise = 1 INR)
                "currency": "INR",
                "name": "{{ book.title }}",  // Book title
                "description": "Payment for the book: {{ book.title }}",
                "image": "{{ book.images.url }}",  // Book image for Razorpay modal
                "order_id": "{{ data.id }}",  // Razorpay order ID passed from Django view
                "handler": function (response) {
                    alert("Payment done successfully!");
                    // Optionally, you can redirect or process the payment response here
                    // Example: window.location.href = '/showorders';
                },
                "prefill": {
                    "name": "{{ request.user.username }}",  // User's name
                    "email": "{{ request.user.email }}",  // User's email
                    "contact": "{{ request.user.profile.phone_number }}"  // User's phone number (if available)
                },
                "notes": {
                    "address": "Razorpay Corporate Office"
                },
                "theme": {
                    "color": "#3399cc"  // Customize the theme color (optional)
                }
            };

            var rzp1 = new Razorpay(options);

            rzp1.on('payment.failed', function (response) {
                alert("Transaction cancelled. Try again");
            });

            document.getElementById('rzp-button1').onclick = function(e) {
                rzp1.open();
                e.preventDefault();
            };
        </script>
    </div>
</div>

{% endblock %}